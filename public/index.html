
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rails Micro Wins</title>
  <meta name="author" content="Marc Garreau">

  
  <meta name="description" content="Scopes allow you to make (what amounts to) helper methods for
commonly used Active Record queries. For example, we can easily display a restaurant& &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.railsmicrowins.com">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Rails Micro Wins" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1>Rails Micro Wins</h1>
  
    <h2><a href="/">Babystep your way to production</a></h2>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.railsmicrowins.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/17/using-scopes/">Using Scopes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-17T14:52:32-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Scopes allow you to make (what amounts to) helper methods for
commonly used Active Record queries.</p>

<p>For example, we can easily display a restaurant&rsquo;s appropriate
seasonal menu using scopes. Within the model, we&rsquo;ll build a scope
for items on the winter seasonal menu:</p>

<figure class='code'><figcaption><span>item.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:winter</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">seasonal_menu</span><span class="p">:</span> <span class="s2">&quot;winter&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In our items controller now, we can call <code>Item.winter</code> to pass
only those items on the winter menu to our view. We also experience
the joy of pushing logic from our controller, down to the model.</p>

<p>Scopes can also be chained, to form more specific queries:</p>

<figure class='code'><figcaption><span>item.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:winter</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">seasonal_menu</span><span class="p">:</span> <span class="s2">&quot;winter&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:winter_high_carb</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">winter</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;carbs &gt; 30&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Another common use case for scopes is to redefine how our query results
are ordered by default. The helper method <code>default_scope</code> exists:</p>

<figure class='code'><figcaption><span>item.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Item</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">default_scope</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;name ASC&#39;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, items will now be displayed in alphabetical order by default.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/08/installing-rspec-in-rails/">Installing RSpec in Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-08T13:34:35-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>By default, you&rsquo;ll get a <code>test</code> folder with Minitest ready to rock when you generate a new rails project. Switching to the other team is a cinch though.</p>

<p>To generate a new rails project without a test suite, run:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>$</span></pre></td><td class='code'><pre><code><span class='line command'>rails new sample_app -T</span></code></pre></td></tr></table></div></div>
        </div>


<p>Or to get rid of your Minitest folder in an existing project:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>$</span></pre></td><td class='code'><pre><code><span class='line command'>rm -rf test/</span></code></pre></td></tr></table></div></div>
        </div>


<p>Next, add RSpec to your Gemfile:</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Install the new gem:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>$</span></pre></td><td class='code'><pre><code><span class='line command'>bundle install</span></code></pre></td></tr></table></div></div>
        </div>


<p>Then install RSpec:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>$</span></pre></td><td class='code'><pre><code><span class='line command'>rails generate rspec:install</span></code></pre></td></tr></table></div></div>
        </div>


<p>Look at you go, with your fresh new <code>spec</code> folder in the root directory. Get testing!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/07/creating-an-admin-controller-in-rails/">Creating an Admin Controller</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-07T19:21:52-06:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Why create an Admin Controller?</h2>

<p>It is easy enough to use something like <a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a>
to implement authorization, so why then would you need a separate Admin Controller for your application?</p>

<p>While CanCanCan provides a good base, adding an Admin Controller provides another layer of protection,
as the routes you are trying to protect simply do not exist unless you are properly authenticated as an Admin.</p>

<p>It is easy to leave a route unprotected or make a mistake if your edit/create/update/destroy routes are in
your public controllers, and having an Admin Controller helps prevent mistakes.</p>

<h2>Implementation</h2>

<ol>
<li>Within app/controllers, create another directory called &lsquo;admin&rsquo; and create an <code>admin_controller.rb</code> in that new directory.</li>
<li>Create each individual controller that you want in the admin namespace. For example, if you would like to only allow an admin to edit or delete an item, create a new Items Controller with those actions inside of the controllers/admin folder.</li>
<li>Remove the newly protection actions from the old Items Controller, leaving only those actions that you&rsquo;d like users to access (e.g. show and index).</li>
<li>Add the admin namespace to your routes file:</li>
</ol>


<figure class='code'><figcaption><span>routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:items</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">resources</span> <span class="ss">:items</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that our old Item Controller still maintains it&rsquo;s own routes, which we specify with <code>:index</code> and <code>:show</code>.</p>

<p>Now when we <code>rake routes</code>, you&rsquo;ll see the newly created namespaced routes:</p>

<div class="window">
          <nav class="control-window">
            <a href="#finder" class="close" data-rel="close">close</a>
            <a href="#" class="minimize">minimize</a>
            <a href="#" class="deactivate">deactivate</a>
          </nav>
          <h1 class="titleInside">Terminal</h1>
          <div class="container"><div class="terminal"><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span>
<span class='line-number'>&nbsp;</span></pre></td><td class='code'><pre><code><span class='line output'>new_admin_item  GET   admin/items/new         admin/items#new
</span><span class='line output'>   admin_items  POST  admin/items(.:format)   admin/items#create
</span><span class='line output'>
</span><span class='line output'>  # etc...</span></code></pre></td></tr></table></div></div>
        </div>


<h2>Sticking Point</h2>

<p>Note that you will have to customize the POST from your admin forms:
<code>&lt;%= form_for(@item, :url =&gt; admin_item_path(@item) ) do |f| %&gt;</code></p>

<p><em>Authored by Ian Andersen (<a href="http://twitter.com/ianderse27">@ianderse27</a>). The original post is available <a href="http://mindfulprogramming.com/creating-an-admin-controller-in-rails/">here</a>.</em></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Marc Garreau -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'railsmicrowins';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
